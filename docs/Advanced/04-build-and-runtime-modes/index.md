---
title: "第四章：代码运行的三种状态与构建原理"
---


![04-build-and-runtime-modes_index.png](../../public/images/Advanced/04-build-and-runtime-modes_index.png)
# 第四章：代码运行的三种状态与构建原理

## 序言

代码写好了，怎么运行？你可能以为很简单：不就是点击运行按钮吗？但在现代 Web 开发中，代码有三种运行状态，每种状态都有不同的目的和行为。

### 三种状态：Dev、Build、Preview

老师傅说："把这三种状态理解为：**Dev 是打草稿，Build 是排版印刷，Preview 是模拟上线**。"

- **Dev 模式**：开发模式，用于本地开发。支持热重载（修改代码立即看到效果），有详细的错误信息，但性能不是最优。
- **Build 模式**：构建模式，生成生产环境的代码。代码会被压缩、优化、分割，性能最优，但没有开发便利功能。
- **Preview 模式**：预览模式，在本地模拟生产环境。用于在部署前预览最终效果。

### package.json

**package.json** 是项目的身份证，里面记录了项目的名称、版本、依赖、脚本等。老师傅说："理解 package.json 是理解 Node.js 项目的第一步。它不仅管理依赖（dependencies），还管理脚本（scripts）、版本（engines）、配置（config）等。"

### 构建产物

当你运行 `pnpm build` 后，会生成一个 `.next` 文件夹（Next.js 项目）或 `dist` 文件夹（其他框架），这就是**构建产物**。这些文件是真正要部署到服务器上的。老师傅提醒："不要尝试修改构建产物，因为每次 `build` 都会重新生成。如果要修改，改源代码然后重新构建。"

### 缓存

**缓存**是个好东西，能显著提升性能，但也是很多问题的根源。浏览器会缓存静态文件，构建工具会缓存中间结果。但有时候你明明修改了代码，看到的还是旧结果，这就是缓存的问题。老师傅说："遇到怪异问题时，先尝试清除缓存。浏览器用 Ctrl+Shift+R 强制刷新，构建工具用 `pnpm build --force` 强制重新构建。"

### 环境变量生效（🆕 预告）

"最后，"老师说，"**环境变量**有个陷阱：修改 `.env` 文件后，必须重启开发服务器才能生效。很多人改了环境变量，发现没效果，就是因为没重启服务。**【详见第6章】** 会详细解释为什么。"
